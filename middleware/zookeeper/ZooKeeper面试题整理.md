1. ZooKeeper是什么？

ZooKeeper是一个开放源码的分布式应用协调服务，它是集群的管理者，监视着集群中各个节点的状态根据节点的反馈进行下一步合理操作。

分布式应用程序可以基于Zookeeper实现诸如数据发布/订阅、负载均衡、命名服务、集群管理、分布式锁、集中配置管理、分布式队列等功能。

Zookeeper保证了如下分布式一致性特性：

* 顺序一致性

* 原子性

* 单一视图

* 可靠性

* 实时性（最终一致性）

  客户端的读请求可以被集群中的任一台机器处理，如果读请求在节点上注册了监听器，这个监听器也是由所连接的zookeeper机器来处理。对于写请求，这些请求会同时发给其它zookeeper机器并达成一致后，请求才会返回成功。因此，随着zookeeper的集群机器增加，读请求的吞吐会提高但是写请求的吞吐会下降。

  有序性是zookeeper中非常重要的一个特性，所有的更新都是全局有序的，每个更新都有一个唯一的时间戳，这个时间戳称为zxid（Zookeeper Transaction Id）

2. ZooKeeper提供了什么？

   * 文件系统
   * 通知机制

3. Zookeeper文件系统

   Zookeeper提供一个多层级的节点命名空间（节点称为znode）。与文件系统不同的是，这些节点可以设置关联的数据，而文件系统中只有文件节点可以存放数据而目录节点不行。

   Zookeeper为了保证高吞吐和低延时，在内存中维护了这个树状的目录结构，这个特性使得Zookeeper不能用于存放大量的数据，每个节点存放数据的上限为1M

4. ZAB协议

   ZAB协议是为分布式协调服务Zookeeper专门设计的一种支持崩溃恢复的原子广播协议。

   ZAB协议包括两种基本的模式：崩溃恢复和消息广播

   当整个zookeeper集群刚刚启动或者Leader服务器宕机、重启或者网络故障导致不存在过半的服务器与Leader服务器保持正常通信时，所有进程（服务器）进入崩溃恢复模式，首先选举产生新的Leader服务器，然后集群中Follower服务器开始与新的Leader服务器进行数据同步，当集群中超过半数机器与该Leader服务器完成数据同步之后，退出恢复模式进入消息广播模式，Leader服务器开始接收客户端的事务请求生成事物提案来进行事务请求处理。

5. 四种类型的数据节点znode

   persistent-持久节点

   除非手动删除，否则节点一直存储在Zookeeper上

   ephemeral-临时节点

   临时节点的生命周期与客户端会话绑定，一旦客户端会话失效（客户端与zookeeper连接断开不一定会话失效），那么这个客户端创建的所有临时节点都会被移除。

   persistent_sequential-持久顺序节点

   基本特性同持久节点，只是增加了顺序属性，节点名后边会追加一个由父节点维护的自增整型数字。

   ephemeral_sequential-临时顺序节点

   基本特性同临时节点，只是增加了顺序属性，节点名后边会追加一个由父节点维护的自增整型数字。

6. Zookeeper Watcher机制 -- 数据变更通知

   Zookeeper允许客户端向服务端的某个znode节点注册一个Watcher监听，当服务端的一些指定事件触发了这个Watcher，服务端会向指定客户端发送一个事件通知来实现分布式的通知功能，然后客户端根据Watcher通知状态和事件类型做出业务上的改变。

   工作机制：

   客户端向服务端某个znode节点注册watcher

   服务端处理watcher

   服务端回调客户端watcher

7. 客户端注册Watcher实现

   